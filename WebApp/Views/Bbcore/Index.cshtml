<main>
    <div class="container">
        <div class="row">
            <div class="col s6">
                <div id="icon-prefixes" class="card card-tabs">
                    <div class="card-content">
                        <div class="card-title">
                            <div class="row">
                                <div class="col s12 m6 l10">
                                    <h4 class="card-title">Control de Transfusión de Pacientes - BBCORE</h4>
                                </div>
                            </div>
                        </div>
                        <div id="view-icon-prefixes" class="active">
                            <div class="row">
                                <div class="row">
                                    <div class="input-field col s8">
                                        <i class="material-icons prefix">account_circle</i>
                                        <input id="icon_prefix3" type="text" v-on:keyup.enter="CargarProcedimientos()" v-model="hc" name="hc" value="" placeholder="Ingrese H.C" class="validate" autofocus>
                                        <label for="icon_prefix3" class="">Historia Clinica</label>
                                    </div>
                                    <div class="input-field col s3">
                                        <div class="form-actions no-color">
                                            <input type="button" v-on:click="CargarProcedimientos()" value="Buscar" class="btn btn-primary" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col s6" v-if="Procedimientos.length>1">
                <div id="icon-prefixes" class="card card-tabs">
                    <div class="card-content">
                        <div class="card-title">
                            <div class="row">
                                <div class="col s12 m6 l10">
                                    <h4 class="card-title">Procedimientos</h4>
                                </div>
                            </div>
                        </div>
                        <div id="view-icon-prefixes" class="active">
                            <div class="row">
                                <div class="input-field col s12">
                                    <div v-for="i in Procedimientos">
                                        <p>
                                            <a target="_blank" v-bind:href="'@Url.Action("ReporteMovimientoBbCore2","Reporte")' + '?proc=' + i.num_proc + '&hc=' + i.num_doc">{{ i.num_proc }}-{{ i.Fecha }}</a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</main>

@section scripts{
    <script>
        //Modelo
            var vapp = new Vue({
                el: 'main',
                data: {
                    hc: "",
                    Procedimientos: [],
                    num_proc:""
                },
                methods: {
                    CargarProcedimientos: function () {
                        var self = this;
                        $.get('@Url.Action("ListarProcedimiento", "Reporte")', { pHc: self.hc }, function (d) {
                            if (d.length == 1) {
                                //Llamar el procedimiento
                                window.open('@Url.Action("ReporteMovimientoBbCore2","Reporte")?proc=' + d[0].num_proc + '&hc=' + self.hc);
                                self.Procedimientos = [];
                                return;
                            }
                            if (d.length == 0) {
                                Swal.fire(
                                    'No existe',
                                    'No existe procedimientos para esta historia',
                                    'error'
                                );
                            }
                            self.Procedimientos = d;
                        });
                    }
                }
            });
    </script>
}